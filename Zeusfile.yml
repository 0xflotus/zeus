############
# ZEUSFILE #
############

# globals for all build commands

globals: |
    buildDir=bin

# all commands
commands: 
    build:
        args: name:String
        chain: configure
        help: build project for current OS
		buildNumber: true
        run: |
            echo "building $name for current OS"
            rice embed-go
			godep go build -o ${buildDir}/$name
    build-linux:
        chain: configure
        help: build project for linux amd64
		buildNumber: true
        run: |
            echo "building for linux amd64"
            rice embed-go
			GOOS=linux GOARCH=amd64 godep go build -o ${buildDir}/zeus-linux
    optional:
        args: name:String? = "defaultName", bla:String, ok:Bool?, count:Int?, req:String
        help: test optionals
        run: |
            echo "name=$name"
            echo "bla=$bla"
            echo "ok=$ok"
            echo "count=$count"
            echo "req=$req"
	build-race:
        chain: clean
        help: build race detection enabled binary
        manual: |
			zeus build-race script
			this script produces the zeus binary with race detection enabled
        run: go build -race
	clean:
        help: clean up to prepare for build
        run: |
            rm -rf bin/*
            rm -rf tests/*.yml
	configure:
        help: prepare JS and CSS and move assets into wiki/docs
        manual: Generate Javascript and CSS
        run: |

            echo "copying LICENSE and README.md"

            cp -f LICENSE wiki/docs
            cp -f README.md wiki/docs

            jsobfus -d frontend/src/js/:frontend/dist/js
			sasscompile -d frontend/src/sass:frontend/dist/css
	dev:
        help: start the dev mode
		chain: clean -> configure
        manual: |
			zeus development mode script
			this script compiles the binary without assets
        run: |
			rm -f rice-box.go
			go install
    install:
        chain: clean -> configure
        help: install to $PATH
        manual: Install the application to the default system location
        run: |
            echo "installing zeus"
			rice embed-go
			godep go install
	reset:
        chain: clean
        help: reset and delete all generated files
        manual: zeus reset script
        run: rm -f rice-box.go
	
    # run the test with race detection enabled
    test-race:
        chain: clean
        help: start data race detection tests
        manual: zeus data race detection test script
        run: go test -v -race

    # run the tests
	test:
        chain: clean
        help: run automated tests
        manual: zeus automated tests
        run: |
            echo "starting tests"

            go test -v -coverprofile coverage.out -cover

            if [[ $? == 0 ]]; then
                go tool cover -html=coverage.out
            fi